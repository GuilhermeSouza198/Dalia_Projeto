<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="perfil.css">
    <title>Dália</title>
    <link rel="shortcut icon" type="image/png" href="/img/navbar/dália_secundario.png">
</head>
<body>
    <header>
        <div class="logo">
            <img src="./img/navbar/Logo_dalia.png" alt="Logo">
        </div>
        <nav>
            <ul>
                <li class="Home"><a href="../home/index.html"><img src="./img/navbar/Home__nav.svg" alt=""></a></li>
                <li class="Calendario"><a href="../calendario/calendario.html"><img src="./img/navbar/Calendar__nav.svg"></a></li>
                <li class="forum"><a href="../forum/forum.html"><img src="./img/navbar/Fórum__nav.svg"></a></li>
                <li class="principal"><a href="../principal/principal.html"><img src="./img/navbar/Flower__nav.svg" alt=""></a></li>
                <li class="perfil"><a href="../perfil/perfil.html"><img src="./img/navbar/profile-full__nav.svg"></a></li>
            </ul>
        </nav>
    </header>

    <main>
        <div class="figura-horizontal">
            <img src="./img/perfil_img/quadriculado-rosa.png" alt="Imagem de fundo">
        </div>
        <div class="Area">
            <h1 class="titulo">Área do usuário</h1>
            <div class="configurações">
                <button class="conf" id="google_translate_element"></button>
                <button class="conf" id="denuncia-button">Fazer Denúncia</button>
            </div>
            <div class="perfil">
                <div class="user-img">
                    <img src="./img/perfil_img/perfil.png" id="foto" class="perfil__foto">
                    <label for="input-file" id="uploadft"><img src="./img/perfil_img/editsvg.svg" class="edit-icon"></label>
                    <input type="file" accept="image/jpeg, image/png, image/jpg" id="input-file" style="display:none;">
                </div>
                
                <label class="label" for="name">Nome:</label>
                <input class="type" id="name" placeholder="Seu nome aqui" readonly>
                <button id="edit-name-button">Editar Nome</button>
                
                <label class="label" for="date">Data de nascimento</label>
                <input class="info" type="date" id="date"></input>
                <label class="label" for="select">Estado civil</label>
                <select class="custom-select" id="inputGroupSelect01">
                    <option selected>Escolha uma das opções</option>
                    <option value="1">Solteira</option>
                    <option value="2">Casada</option>
                    <option value="3">Divorciada</option>
                </select>
                <div class="buttons">
                    <button class="editar" id="salvar">Salvar</button>
                </div>
            </div>
        </div>
    </main>

    <div id="popup" class="popup" style="display:none;">
        <div class="popup-content">
            <span class="close">&times;</span>
            <p>Será iniciada uma chamada anônima com a Delegacia da Mulher.</p>
        </div>
    </div>

    <script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
    <script>
        new window.VLibras.Widget('https://vlibras.gov.br/app');
    </script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="perfil.js"></script>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

    <script>
        async function fetchUserName() {
            const email = localStorage.getItem('userEmail');
            if (!email) return;

            try {
                const response = await fetch(`http://192.168.1.53:3333/user/email?email=${email}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                const data = await response.json();
                if (data.nome) {
                    document.getElementById('name').value = data.nome;
                } else {
                    console.error('Nome não encontrado.');
                }
            } catch (error) {
                console.error('Erro ao buscar o nome do usuário:', error);
            }
        }

        document.getElementById('edit-name-button').addEventListener('click', function () {
            const nameInput = document.getElementById('name');
            if (nameInput.readOnly) {
                nameInput.readOnly = false;
                nameInput.focus(); 
            } else {
                const newName = nameInput.value.trim();
                if (newName) {
                    updateUserName(newName);
                }
                nameInput.readOnly = true; 
            }
        });

        async function updateUserName(newName) {
            const email = localStorage.getItem('userEmail');
            if (!email) return;

            try {
                const response = await fetch('http://192.168.1.53:3333/user/update', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, nome: newName }),
                });

                if (!response.ok) {
                    throw new Error('Erro ao atualizar o nome do usuário');
                }

                const data = await response.json();
                console.log('Nome atualizado com sucesso:', data);
            } catch (error) {
                console.error('Erro ao atualizar o nome do usuário:', error);
            }
        }

        window.onload = fetchUserName;
    </script>
</body>
</html>
